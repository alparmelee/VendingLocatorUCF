<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UCF Vending Locator</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Supabase JS -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>
    <script src="auth.js"></script>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body>
    <div class="app-container">
        <!-- Header -->
        <header class="glass-header">
            <div class="logo-container">
                <div class="ucf-logo">
                    <span class="ucf-text">UCF</span>
                </div>
                <h1>Vending Locator</h1>
            </div>
            <div class="header-actions">
                <button id="open-add-machine-btn" class="btn-primary auth-required hidden">
                    <i data-lucide="plus"></i> Add Machine
                </button>
                <div id="auth-controls">
                    <a href="login.html" id="login-btn" class="btn-secondary">Login</a>
                    <button id="logout-btn" class="btn-secondary hidden">Logout</button>
                </div>
            </div>
        </header>

        <!-- Search Section -->
        <section class="search-section">
            <div class="search-container glass-panel">
                <i data-lucide="search" class="search-icon"></i>
                <input type="text" id="search-input" placeholder="Search for snacks, drinks, or locations...">
            </div>
        </section>

        <!-- Map Section -->
        <section id="map-section" class="glass-panel">
            <div id="map"></div>
            <div id="map-instruction" class="map-overlay hidden">
                <div class="instruction-content glass-panel">
                    <i data-lucide="map-pin"></i>
                    <span>Click on the map to place the machine</span>
                    <button id="cancel-selection" class="btn-secondary btn-small">Cancel</button>
                </div>
            </div>
        </section>

        <!-- Dashboard / Machine List -->
        <main id="machine-list" class="machine-grid">
            <!-- Machines will be injected here by JS -->
        </main>
    </div>

    <!-- Add Machine Modal -->
    <div id="add-machine-modal" class="modal-overlay hidden">
        <div class="modal glass-panel">
            <div class="modal-header">
                <h2>Add Vending Machine</h2>
                <button class="close-modal-btn" data-target="add-machine-modal"><i data-lucide="x"></i></button>
            </div>
            <form id="add-machine-form">
                <div class="form-group">
                    <label for="machine-name">Machine Name / ID</label>
                    <input type="text" id="machine-name" required placeholder="e.g. Student Union 1st Floor">
                </div>
                <div class="form-group">
                    <label for="machine-location">Location Description</label>
                    <input type="text" id="machine-location" required placeholder="e.g. Near the main entrance">
                </div>
                <div id="location-picker-status" class="form-group" style="padding: 10px; background: rgba(255, 255, 255, 0.05); border-radius: 8px; border: 1px dashed var(--glass-border); margin-bottom: 15px; text-align: center;">
                    <p id="location-status-text" style="font-size: 0.85rem; color: var(--text-secondary); margin: 0;">
                        <i data-lucide="check-circle" size="14" style="vertical-align: middle; color: #2ed573;"></i> 
                        Location selected
                    </p>
                    <input type="hidden" id="machine-lat">
                    <input type="hidden" id="machine-lng">
                </div>
                <button type="submit" class="btn-primary full-width">Create Machine</button>
            </form>
        </div>
    </div>

    <!-- Edit Machine Modal -->
    <div id="edit-machine-modal" class="modal-overlay hidden">
        <div class="modal glass-panel">
            <div class="modal-header">
                <h2>Edit Vending Machine</h2>
                <button class="close-modal-btn" data-target="edit-machine-modal"><i data-lucide="x"></i></button>
            </div>
            <form id="edit-machine-form">
                <input type="hidden" id="edit-machine-id">
                <div class="form-group">
                    <label for="edit-machine-name">Machine Name / ID</label>
                    <input type="text" id="edit-machine-name" required>
                </div>
                <div class="form-group">
                    <label for="edit-machine-location">Location Description</label>
                    <input type="text" id="edit-machine-location" required>
                </div>
                <div id="edit-location-picker-status" class="form-group" style="padding: 10px; background: rgba(255, 255, 255, 0.05); border-radius: 8px; border: 1px dashed var(--glass-border); margin-bottom: 15px; text-align: center;">
                    <p id="edit-location-status-text" style="font-size: 0.85rem; color: var(--text-secondary); margin: 0;">
                        <i data-lucide="map-pin" size="14" style="vertical-align: middle;"></i> 
                        Location fixed. Click "Change Location" to move.
                    </p>
                    <input type="hidden" id="edit-machine-lat">
                    <input type="hidden" id="edit-machine-lng">
                    <button type="button" id="change-location-btn" class="btn-secondary btn-small" style="margin-top: 10px; width: auto; display: inline-block;">Change Location</button>
                </div>
                <button type="submit" class="btn-primary full-width">Save Changes</button>
            </form>
        </div>
    </div>

    <!-- Add Item Modal -->
    <div id="add-item-modal" class="modal-overlay hidden">
        <div class="modal glass-panel" style="max-width: 600px;">
            <div class="modal-header">
                <h2>Add Items to <span id="target-machine-name">Machine</span></h2>
                <button class="close-modal-btn" data-target="add-item-modal"><i data-lucide="x"></i></button>
            </div>
            <form id="add-item-form">
                <input type="hidden" id="target-machine-id">
                <div id="items-container">
                    <!-- Item rows will be added here -->
                    <div class="item-entry-row glass-panel" style="padding: 15px; margin-bottom: 15px; border: 1px solid var(--glass-border);">
                        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 10px; margin-bottom: 10px;">
                            <div class="form-group" style="margin-bottom: 0;">
                                <label>Item Name</label>
                                <input type="text" class="item-name-input" required placeholder="e.g. Coca Cola">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label>Price ($)</label>
                                <input type="number" class="item-price-input" step="0.01" required placeholder="1.50">
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; align-items: center;">
                            <div class="form-group" style="margin-bottom: 0;">
                                <label>Category</label>
                                <select class="item-category-input" style="width: 100%; padding: 10px; background: rgba(255, 255, 255, 0.05); border: 1px solid var(--glass-border); border-radius: 8px; color: var(--text-primary); outline: none;">
                                    <option value="beverages">Beverage</option>
                                    <option value="snacks">Snack</option>
                                </select>
                            </div>
                            <div class="form-group checkbox-group" style="margin-bottom: 0;">
                                <input type="checkbox" class="item-stock-input" checked id="stock-check-0">
                                <label for="stock-check-0">In Stock</label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button type="button" id="add-more-items-btn" class="btn-secondary" style="margin-bottom: 20px;">
                    <i data-lucide="plus"></i> Add Another Item Row
                </button>
                
                <button type="submit" class="btn-primary full-width">Add All Items</button>
            </form>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="script.js"></script>
</body>

</html>